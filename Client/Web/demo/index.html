<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASR å®æ—¶è¯­éŸ³è¯†åˆ« Demo</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <h1>ğŸ¤ ASR å®æ—¶è¯­éŸ³è¯†åˆ« Demo</h1>
        
        <div class="status-bar">
            <div class="status-indicator">
                <div class="status-dot" id="statusDot"></div>
                <span class="status-text" id="statusText">æœªè¿æ¥</span>
            </div>
            <div class="status-indicator">
                <span class="status-text" id="taskIdText">Task ID: -</span>
            </div>
        </div>
        
        <div class="main-content">
            <!-- 1. æœåŠ¡å™¨é…ç½® -->
            <div class="module module-server-config">
                <div class="module-title">1. æœåŠ¡å™¨é…ç½®</div>
                <div class="config-row">
                    <label class="config-label">æœåŠ¡ç±»å‹:</label>
                    <select class="config-input" id="serviceType" onchange="updateServerUrl()">
                        <option value="local" selected>æœ¬åœ°æœåŠ¡</option>
                        <option value="aliyun">é˜¿é‡Œäº‘æœåŠ¡</option>
                    </select>
                </div>
                <div class="config-row">
                    <label class="config-label">æœåŠ¡åœ°å€:</label>
                    <input type="text" class="config-input" id="serverUrl" value="ws://localhost:8000/ws" placeholder="ä¾‹å¦‚: wss://dashscope.aliyuncs.com/api-ws/v1/inference">
                </div>
                <script>
                    function updateServerUrl() {
                        const serviceType = document.getElementById('serviceType').value;
                        const serverUrl = document.getElementById('serverUrl');
                        const apiKey = document.getElementById('apiKey');
                        const model = document.getElementById('model');
                        if (serviceType === 'aliyun') {
                            serverUrl.value = 'wss://dashscope.aliyuncs.com/api-ws/v1/inference';
                            apiKey.value = 'sk-a7558f9302974d1891906107f6033939';
                            model.value = 'paraformer-realtime-v2';
                        } else {
                            serverUrl.value = 'ws://localhost:8000/ws';
                            apiKey.value = 'AsrServer';
                            model.value = 'paraformer-zh-streaming';
                        }
                    }
                </script>
                <div class="config-row">
                    <label class="config-label">API Key:</label>
                    <input type="password" class="config-input" id="apiKey" placeholder="é˜¿é‡Œäº‘DASHSCOPE_API_KEY">
                </div>
                <div class="config-row">
                    <label class="config-label">æ¨¡å‹:</label>
                    <input type="text" class="config-input" id="model" list="model-suggestions" placeholder="ä¾‹å¦‚: paraformer-realtime-v2" value="">
                    <datalist id="model-suggestions">
                        <option value="paraformer-realtime-v2">paraformer-realtime-v2ï¼ˆæ¨èï¼‰</option>
                        <option value="paraformer-realtime-8k-v2">paraformer-realtime-8k-v2ï¼ˆæ¨èï¼‰</option>
                        <option value="paraformer-realtime-v1">paraformer-realtime-v1</option>
                        <option value="paraformer-realtime-8k-v1">paraformer-realtime-8k-v1</option>
                        <option value="paraformer-realtime">paraformer-realtime</option>
                        <option value="paraformer-realtime-8k">paraformer-realtime-8k</option>
                    </datalist>
                </div>
                <div class="config-row" style="margin-top: 20px;">
                    <button class="btn btn-primary" onclick="testConnection()" style="margin-left: 190px;">æµ‹è¯•è¿æ¥</button>
                </div>
                
                <!-- 2.1 æœåŠ¡å™¨APIè°ƒç”¨å‚æ•°é…ç½® -->
                <div class="sub-module">
                    <div class="sub-module-title">2.1 æœåŠ¡å™¨APIè°ƒç”¨å‚æ•°é…ç½®</div>
                    <div class="config-row">
                        <label class="config-label">é‡‡æ ·ç‡:</label>
                        <select class="config-input" id="sampleRate">
                            <option value="16000">16000 Hz</option>
                            <option value="8000">8000 Hz</option>
                        </select>
                    </div>
                    <div class="config-row">
                        <label class="config-label">éŸ³é¢‘æ ¼å¼:</label>
                        <select class="config-input" id="audioFormat">
                            <option value="pcm" selected>PCM</option>
                            <option value="wav">WAV</option>
                            <option value="mp3">MP3</option>
                            <option value="opus">Opus</option>
                            <option value="speex">Speex</option>
                            <option value="aac">AAC</option>
                            <option value="amr">AMR</option>
                        </select>
                    </div>
                    <div class="config-row">
                        <label class="config-label">æ ‡ç‚¹é¢„æµ‹:</label>
                        <input type="checkbox" class="config-checkbox" id="punctuationEnabled" checked>
                    </div>
                    <div class="config-row">
                        <label class="config-label">æ–‡æœ¬å½’ä¸€åŒ–:</label>
                        <input type="checkbox" class="config-checkbox" id="normalizationEnabled" checked>
                    </div>

                    <div class="config-row">
                        <label class="config-label">å¯ç”¨è¯­ä¹‰æ–­å¥:</label>
                        <input type="checkbox" class="config-checkbox" id="semanticPunctuationEnabled">
                    </div>
                    <div class="config-row">
                        <label class="config-label">é™éŸ³æ—¶é•¿é˜ˆå€¼:</label>
                        <input type="number" class="config-input" id="maxSentenceSilence" value="800" min="200" max="6000" step="100">
                    </div>
                    <div class="config-row">
                        <label class="config-label">å¯ç”¨å¤šé˜ˆå€¼æ¨¡å¼:</label>
                        <input type="checkbox" class="config-checkbox" id="multiThresholdModeEnabled">
                    </div>
                    <div class="config-row">
                        <label class="config-label">è¿‡æ»¤è¯­æ°”è¯:</label>
                        <input type="checkbox" class="config-checkbox" id="disfluencyRemovalEnabled">
                    </div>
                    <div class="config-row">
                        <label class="config-label">å¯ç”¨å¿ƒè·³:</label>
                        <input type="checkbox" class="config-checkbox" id="heartbeatEnabled">
                    </div>
                    <div class="config-row">
                        <label class="config-label">è¯­è¨€æç¤º:</label>
                        <select class="config-input" id="languageHints">
                            <option value="auto" selected>è‡ªåŠ¨</option>
                            <option value="zh">ä¸­æ–‡</option>
                            <option value="en">è‹±æ–‡</option>
                            <option value="ja">æ—¥è¯­</option>
                            <option value="yue">ç²¤è¯­</option>
                            <option value="ko">éŸ©è¯­</option>
                            <option value="de">å¾·è¯­</option>
                            <option value="fr">æ³•è¯­</option>
                            <option value="ru">ä¿„è¯­</option>
                        </select>
                    </div>
                    <div class="config-row">
                        <label class="config-label">çƒ­è¯ID:</label>
                        <input type="text" class="config-input" id="vocabularyId" placeholder="å¯é€‰ï¼Œçƒ­è¯ID">
                    </div>
                </div>
            </div>
            
            <!-- 2. é…ç½®å‚æ•° -->
            <div class="module module-config">
                <div class="module-title">2. é…ç½®å‚æ•°</div>
                
                <!-- 2.1 é¢„å¤„ç†é…ç½® -->
                <div class="sub-module">
                    <div class="sub-module-title">2.1 å®¢æˆ·ç«¯é¢„å¤„ç†å‚æ•°é…ç½®</div>
                    <div class="config-row">
                        <label class="config-label">å¯ç”¨ VAD é¢„å¤„ç†:</label>
                        <input type="checkbox" class="config-checkbox" id="vadEnabled">
                    </div>
                    <div class="config-row">
                        <label class="config-label">VAD æ¨¡å¼:</label>
                        <select class="config-input" id="vadMode">
                            <option value="0">æ¨¡å¼ 0 (æœ€å®½æ¾)</option>
                            <option value="1">æ¨¡å¼ 1</option>
                            <option value="2">æ¨¡å¼ 2</option>
                            <option value="3">æ¨¡å¼ 3 (æœ€ä¸¥æ ¼)</option>
                        </select>
                    </div>
                    <div class="config-row">
                        <label class="config-label">é™éŸ³æ—¶é•¿é˜ˆå€¼:</label>
                        <input type="number" class="config-input" id="silenceDuration" value="800" min="100" max="3000" step="100">
                    </div>
                    <div class="config-row">
                        <label class="config-label">é™éŸ³é˜ˆå€¼:</label>
                        <input type="number" class="config-input" id="silenceThreshold" value="0.01" min="0.001" max="0.1" step="0.001">
                    </div>
                    <div class="config-row">
                        <label class="config-label">é‡‡æ ·ç‡:</label>
                        <select class="config-input" id="localSampleRate">
                            <option value="16000">16000 Hz</option>
                            <option value="8000">8000 Hz</option>
                        </select>
                    </div>
                </div>
                
                <!-- 2.2 å®æ—¶éŸ³é¢‘å¼ºåº¦ -->
                <div class="sub-module">
                    <div class="sub-module-title">2.2 å®æ—¶éŸ³é¢‘å¼ºåº¦</div>
                    <div class="audio-intensity-container">
                        <canvas id="audioIntensityCanvas" class="audio-intensity-canvas"></canvas>
                    </div>
                </div>
                
                <!-- 2.3 å‘å‡ºéŸ³é¢‘åˆ—è¡¨ -->
                <div class="sub-module">
                    <div class="sub-module-title">2.3 å‘å‡ºéŸ³é¢‘åˆ—è¡¨</div>
                    <div class="audio-list-container">
                        <div id="audioList" class="audio-list"></div>
                    </div>
                </div>
            </div>
            
            <!-- 3. æ§åˆ¶å’Œç»“æœ -->
            <div class="module module-control-result">
                <div class="module-title">3. æ§åˆ¶å’Œç»“æœ</div>
                
                <!-- 3.1 å››ä¸ªæ“ä½œæŒ‰é’® -->
                <div class="sub-module">
                    <div class="sub-module-title">3.1 å››ä¸ªæ“ä½œæŒ‰é’®</div>
                    <div class="control-panel">
                        <button class="btn btn-primary" id="connectBtn" onclick="connect()">è¿æ¥</button>
                        <button class="btn btn-primary" id="startBtn" onclick="startRecognition()" disabled>å¼€å§‹è¯†åˆ«</button>
                        <button class="btn btn-danger" id="stopBtn" onclick="stopRecognition()" disabled>åœæ­¢è¯†åˆ«</button>
                        <button class="btn btn-danger" id="disconnectBtn" onclick="disconnect()" disabled>æ–­å¼€è¿æ¥</button>
                    </div>
                </div>
                
                <!-- 3.2 è¯†åˆ«ç»“æœ -->
                <div class="sub-module">
                    <div class="sub-module-title">3.2 è¯†åˆ«ç»“æœ</div>
                    <div class="result-area">
                        <div class="result-text" id="resultText">ç­‰å¾…å¼€å§‹è¯†åˆ«...</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 4. æ§åˆ¶å°è¾“å‡º -->
        <div class="module module-log">
            <div class="module-title">4. æ§åˆ¶å°è¾“å‡º</div>
            <div class="log-area" id="logArea">
                <div class="log-entry"><span class="log-time">[ç³»ç»Ÿ]</span> æ¬¢è¿ä½¿ç”¨ ASR å®æ—¶è¯­éŸ³è¯†åˆ« Demo</div>
                <div class="log-entry"><span class="log-time">[ç³»ç»Ÿ]</span> æç¤º: æ­¤å®¢æˆ·ç«¯ç†è®ºä¸Šå…¼å®¹é˜¿é‡Œäº‘DashScope WebSocket API</div>
            </div>
        </div>
    </div>

    <script src="js/lib/AsrClient.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
