# Web Demo 快速部署指南

## 📁 项目结构

```
f:\Project\Python\AsrServer\Client\Web\demo\
├── index.html          # 主页面
├── css\
│   └── style.css       # 样式文件
├── js\
│   ├── app.js          # 应用逻辑
│   └── lib\
│       ├── AsrClient.js        # ASR客户端库
│       └── audio-processor.js  # 音频处理器
├── start.bat           # 启动脚本
└── start_server.py     # 启动服务器脚本
```

## 🚀 快速部署

### 方法一：直接打开
1. **双击** `index.html` 文件
2. 浏览器会自动加载并运行web demo

### 方法二：使用本地服务器（推荐）
1. **双击** `start.bat` 脚本
2. 脚本会启动一个本地HTTP服务器
3. 浏览器会自动打开 `http://localhost:8000`

## 📦 库文件整合情况

### 核心库文件：`js/lib/AsrClient.js`

#### 包含的类和功能：

1. **AudioProcessor 类**
   - 音频录制和处理
   - VAD（语音活动检测）
   - 音频帧处理
   - 配置参数更新

2. **AsrClient 类**
   - WebSocket连接管理
   - 服务通信协调
   - 音频数据发送
   - 回调函数管理

3. **服务适配器**
   - `AsrServiceAdapter`（基类）
   - `LocalAsrAdapter`（本地服务）
   - `AliyunAsrAdapter`（阿里云服务）

4. **AsrClientFactory 类**
   - 客户端创建工厂方法
   - 支持快速创建不同类型的客户端

### 音频处理模块：`js/lib/audio-processor.js`

#### 功能：
- `AudioWorkletProcessor` 实现
- 实时音频处理
- VAD（语音活动检测）
- 音频帧能量计算
- 静音检测和处理

## 🎯 客户端功能

### 1. 服务器配置
- 支持本地服务和阿里云服务切换
- WebSocket连接参数配置
- 服务连接测试

### 2. 参数配置
- **2.1 客户端预处理参数配置**
  - VAD启用/禁用
  - VAD模式选择
  - 静音时长阈值
  - 静音阈值
  - 采样率设置

- **2.2 实时音频强度**
  - 实时音频强度图表
  - 能量值显示（与VAD阈值单位一致）
  - 时间轴显示（最近1秒）

- **2.3 发出音频列表**
  - 音频片段管理
  - 音频播放/暂停
  - 微信风格气泡显示

### 3. 控制和结果
- 连接/断开服务器
- 开始/停止识别
- 实时识别结果显示

### 4. 控制台输出
- 操作日志
- 错误提示
- 状态信息

## 💡 使用说明

### 基本流程
1. **选择服务类型**：本地服务或阿里云服务
2. **配置服务参数**：URL、API Key、模型等
3. **测试连接**：确保服务器可访问
4. **配置VAD参数**：根据需要调整
5. **点击连接**：连接到服务器
6. **点击开始识别**：开始语音识别
7. **查看识别结果**：实时显示在结果区域
8. **点击停止识别**：结束识别
9. **点击断开连接**：断开服务器连接

### 音频列表使用
1. **开始识别**后，音频片段会自动添加到列表
2. **点击音频气泡**：播放/暂停音频
3. **播放状态**：蓝色高亮显示
4. **音频信息**：显示时长和发送时间

### 音频强度图表
1. **开始识别**后，图表会实时更新
2. **Y轴**：能量值（0-0.1），与VAD阈值单位一致
3. **X轴**：时间（最近1秒）
4. **网格线**：辅助查看数值

## 🔧 技术特性

### 1. 兼容性
- 支持现代浏览器（Chrome、Firefox、Edge）
- 支持移动端浏览器
- 兼容阿里云DashScope WebSocket API

### 2. 性能
- 使用AudioWorklet进行音频处理
- 低延迟音频捕获和发送
- 实时音频强度图表

### 3. 可靠性
- 完善的错误处理机制
- WebSocket连接状态管理
- 音频播放自动播放策略处理

### 4. 可扩展性
- 模块化设计
- 服务适配器模式
- 易于添加新的服务支持

## 📋 部署要求

### 浏览器要求
- Chrome 60+
- Firefox 55+
- Edge 79+

### 权限要求
- 麦克风访问权限
- （可选）自动播放音频权限

### 网络要求
- 与服务器的网络连接
- （阿里云服务）互联网连接

## 🔍 故障排查

### 1. 无法访问麦克风
- 检查浏览器是否授予麦克风权限
- 检查系统麦克风设置

### 2. 连接失败
- 检查服务器URL是否正确
- 检查服务器是否运行
- 检查网络连接

### 3. 音频播放失败
- 浏览器阻止了自动播放：先与页面交互（点击、滚动）后再播放
- 检查浏览器音频设置

### 4. 识别无结果
- 检查服务器是否正常运行
- 检查麦克风是否工作
- 检查VAD设置是否合适

## 📞 技术支持

### 联系信息
- 项目维护者：[您的姓名]
- 邮箱：[您的邮箱]
- 项目地址：`f:\Project\Python\AsrServer`

### 常见问题

**Q: 如何切换到阿里云服务？**
A: 在"服务类型"下拉菜单中选择"阿里云服务"，系统会自动填充相关参数。

**Q: VAD设置有什么作用？**
A: VAD（语音活动检测）可以过滤静音，只发送包含语音的音频数据，减少网络传输和服务器负载。

**Q: 音频强度图表的单位是什么？**
A: 能量值（0-0.1），与VAD静音阈值的单位一致。

**Q: 如何调整音频播放质量？**
A: 可以通过调整"采样率"设置来改变音频质量，16000Hz为推荐设置。

## 📚 相关文档

- **项目通信协议**：`F:\Project\Python\AsrServer\Documents\项目通信协议.md`
- **WebSocket API**：`F:\Project\Python\AsrServer\Documents\Paraformer实时语音识别WebSocket API.md`
- **阿里云API**：参考阿里云DashScope文档

---

**🎉 部署完成！** 现在您可以开始使用Web Demo进行语音识别测试了。